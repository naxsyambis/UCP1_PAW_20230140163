<!-- ini belum ku periksa -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <title>Daftar Buku</title>
  </head>
  <body>
    <div class="container mt-5">
      <h1>Daftar Buku</h1>
      <p>Ini adalah halaman daftar buku.</p>

      <% if (buku && buku.length > 0) { %>
      <ul class="list-group">
        <% buku.forEach(function(item) { %>
        <!-- <li class="list-group-item">
          ID: <%= todo.id %> Tugas: <%= todo.task %>
        </li>-->
        <li class="list-group-item">
          ID: <%= todo.id %> | Judul: <%= item.judul %>
          <div class="float-right">
            <button class="btn btn-warning btn-sm" onclick="updateBuku('<%= item.id %>')">Edit</button>
            <button class="btn btn-danger btn-sm" onclick="deleteBuku('<%= item.id %>')">Hapus</button>
          </div>
        </li>
        <% }); %>
      </ul>
      <% } else { %>
      <p>Tidak ada buku yang tersedia.</p>
      <% } %>

      <a href="/" class="btn btn-primary mt-3">Kembali ke Halaman Utama</a>
    </div>
        <!-- Tombol & Form Tambah Todo -->
    <hr>
    <h3>Tambah buku Baru</h3>
    <form id="addBukuForm" class="mb-4">
      <div class="input-group">
        <input type="text" id="newjudul" class="form-control" placeholder="Tulis judul buku baru..." required>
        <div class="input-group-append">
          <button class="btn btn-success" type="submit">Tambah</button>
        </div>
      </div>
    </form>

    <!-- Tombol Refresh -->
    <button id="refreshBtn" class="btn btn-info mb-3">Refresh Data</button>

    <!-- Script Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // Tambah todo
      document.getElementById('addBukuForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const judul = document.getElementById('newjudul').value;
        try {
          await axios.post('/perpustakaan', { judul });
          alert('Buku berhasil ditambahkan!');
          location.reload();
        } catch (err) {
          alert('Gagal menambahkan buku');
        }
      });

      // Delete todo
      async function deleteBuku(id) {
        if (confirm('Hapus buku ini?')) {
          try {
            await axios.delete(`/perpustakaan/${id}`);
            alert('Buku dihapus!');
            location.reload();
          } catch (err) {
            alert('Gagal menghapus buku');
          }
        }
      }

      // Edit todo
      async function updateBuku(id) {
        const newjudul = prompt('Masukkan judul baru:');
        if (newjudul) {
          try {
            await axios.put(`/perpustakaan/${id}`, { judul: newjudul });
            alert('Buku diperbarui!');
            location.reload();
          } catch (err) {
            alert('Gagal memperbarui buku');
          }
        }
      }


      // Refresh
      document.getElementById('refreshBtn').addEventListener('click', function() {
        location.reload();
      });
    </script>

  </body>
</html>